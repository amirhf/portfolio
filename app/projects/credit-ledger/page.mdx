import ProjectPage from '@/components/projects/ProjectPage'
import ProjectHero from '@/components/projects/ProjectHero'
import ProjectSection from '@/components/projects/ProjectSection'
import ProjectScreenshot from '@/components/projects/ProjectScreenshot'

export const metadata = {
  title: 'Fintech Core – Credit Ledger Reference Architecture',
  description:
    'Production-ready reference architecture for financial credits, utilizing double-entry accounting, CQRS, transactional outbox, and event-driven microservices.',
}

<ProjectPage>
  <ProjectHero
    title="Fintech Core: Credit Ledger"
    tagline="Production-ready reference architecture for SaaS credits, marketplace wallets, and usage-based billing."
  >
    <p>
      <strong>Credit Ledger</strong> is a microservices blueprint for teams hitting the limits of simple "credits column" designs. 
      It demonstrates how to build a scalable financial core using <strong>Go, Kafka, and Postgres</strong>—replacing 
      fragile spreadsheets with an immutable, double-entry ledger that guarantees auditability and exactly-once processing.
    </p>
    <p>
      I use this architecture as a reference for consulting clients who need to migrate from "moving fast and breaking things" 
      to "moving money safely".
    </p>
    <div className="mt-6 flex flex-wrap gap-3 text-sm">
      <a
        href="http://ledger.amirhf-demos.info:4000/api"
        target="_blank"
        rel="noreferrer"
        className="rounded-full bg-brand-sky px-4 py-1.5 font-medium text-ink-on-brand hover:bg-brand-sky/90"
      >
        View Swagger API
      </a>
      <a
        href="https://github.com/amirhf/creditLedger"
        target="_blank"
        rel="noreferrer"
        className="rounded-full bg-surface-2 px-4 py-1.5 font-medium text-ink hover:bg-surface-3"
      >
        View on GitHub
      </a>
      <a
        href="https://medium.com/@amirhosseinfirouzmanesh/from-spreadsheet-chaos-to-reliable-credits-ca8fe19fbdb7"
        target="_blank"
        rel="noreferrer"
        className="rounded-full bg-surface-2 px-4 py-1.5 font-medium text-ink hover:bg-surface-3"
      >
        Read Case Study
      </a>
    </div>
  </ProjectHero>

  <ProjectSection title="The Problem: Spreadsheet Chaos">
    <p>
      Most SaaS platforms and marketplaces start simple: a single <code>credits_remaining</code> column in a user table. 
      This works until you scale, leading to:
    </p>
    <ul className="list-disc pl-5 space-y-2">
       <li><strong>Race Conditions:</strong> Concurrent requests double-spend credits.</li>
       <li><strong>Data Drift:</strong> Dashboards, invoices, and databases disagree on the balance.</li>
       <li><strong>Audit Blindness:</strong> Support cannot explain <em>why</em> a customer's balance is 37 instead of 50.</li>
    </ul>
    <p>
      This project solves these issues by treating credits as <strong>financial transactions</strong>, not just a counter.
    </p>
  </ProjectSection>

  <ProjectSection title="Architecture & Patterns">
    <div className="grid gap-6 md:grid-cols-2">
        <ProjectScreenshot
            src="/images/projects/credit-ledger/architecture-diagram.png"
            alt="High-level architecture diagram showing Gateway, Ledger, Outbox, and Read Models."
            caption="The system decouples high-speed writing (Ledger) from querying (Read Models) via an event bus."
        />
        <div>
            <p>
              This is a comprehensive <strong>Reference Architecture</strong> designed to be cloned and adapted. 
              It enforces strict financial invariants while maintaining microservice decoupling:
            </p>
            <ul className="list-disc pl-5 space-y-2 mt-4">
              <li>
                <strong>Double-Entry Core:</strong> Every move is a balanced transaction (Debit/Credit). Money is never created or destroyed, only moved.
              </li>
              <li>
                <strong>Transactional Outbox:</strong> Writes to the DB and publishes events atomically. This prevents "dual-write" hazards where the DB updates but the event fails.
              </li>
              <li>
                <strong>CQRS Projections:</strong> Read models are separate from the ledger. If you need a new dashboard view, you can replay the event history to build it without touching the core ledger.
              </li>
            </ul>
        </div>
    </div>
  </ProjectSection>

  <ProjectSection title="Real-World Use Cases">
    <p>
      Unlike toy demos, this project includes domain modeling for specific business scenarios found in Fintech and SaaS:
    </p>
    <div className="grid gap-4 md:grid-cols-2 mt-4">
        <div className="p-4 bg-surface-2 rounded-lg">
            <h4 className="font-medium text-ink">SaaS Subscriptions</h4>
            <p className="text-sm text-ink-muted mt-2">Granting monthly usage credits that expire, handling overages, and reconciling invoices.</p>
        </div>
        <div className="p-4 bg-surface-2 rounded-lg">
            <h4 className="font-medium text-ink">Marketplace Escrow</h4>
            <p className="text-sm text-ink-muted mt-2">Holding funds in an intermediary wallet until a service is delivered, then releasing to the seller.</p>
        </div>
        <div className="p-4 bg-surface-2 rounded-lg">
            <h4 className="font-medium text-ink">Loyalty Points</h4>
            <p className="text-sm text-ink-muted mt-2">Managing earn/burn rates with audit trails for dispute resolution.</p>
        </div>
        <div className="p-4 bg-surface-2 rounded-lg">
            <h4 className="font-medium text-ink">Digital Wallets</h4>
            <p className="text-sm text-ink-muted mt-2">Peer-to-peer transfers with exactly-once guarantees.</p>
        </div>
    </div>
  </ProjectSection>

  <ProjectSection title="Observability: 'What happened to my credit?'">
    <p>
       A "black box" ledger is useless when money goes missing. This architecture comes pre-wired with a full observability stack to answer support questions instantly.
    </p>
    <div className="grid gap-6 md:grid-cols-2 mt-6">
      <ProjectScreenshot
        src="/images/projects/credit-ledger/ledger-trace-full.png"
        alt="Jaeger trace showing the full journey of a transfer."
        caption="Distributed tracing visualizes the request lifecycle: Gateway → Orchestrator → Ledger Write → Outbox Relay → Kafka → Read Model."
      />
      <ProjectScreenshot
        src="/images/projects/credit-ledger/ledger-metrics-dashboard.png"
        alt="Grafana dashboard showing business metrics and consumer lag."
        caption="Business-level monitoring tracks transfer volume, while system metrics watch for consumer lag and outbox health."
      />
    </div>
    <p className="mt-4">
      The system exposes <strong>OpenTelemetry</strong> traces and <strong>Prometheus</strong> metrics out of the box. 
      This allows operators to distinguish between a slow database, a backed-up Kafka consumer, or a failed external webhook immediately.
    </p>
  </ProjectSection>

  <ProjectSection title="Performance & Benchmarks">
    <p>
      Designed for high-throughput reliability. On a standard 2-vCPU instance, the reference implementation sustains 
      <strong>~400 transfers/second</strong> (end-to-end) with p95 latency under 60ms.
    </p>
    <p>
      It serves as a "middle path" for teams who need more structure than a SQL table but aren't ready to adopt specialized infrastructure like TigerBeetle.
    </p>
  </ProjectSection>
</ProjectPage>